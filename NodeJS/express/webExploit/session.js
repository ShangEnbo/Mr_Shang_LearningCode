// 导入 express 模块
const express = require('express')

// 创建 express 的服务器实例
const app = express()

// 导入 express-session 模块
const session = require('express-session')

// 配置 session 中间件
app.use(
  session({
    secret: 'keyboard cat',
    resave: false,
    saveUninitialized: true
  })
)

app.use('/index.html', express.static('../index.html'))

app.use(express.urlencoded({ extended: false }))

// 登录接口
app.post('/api/login', (req, res) => {
  if(req.body.username !== 'admin' || req.body.password !== '000000') {
    return res.send({ status: 1, msg: '登录失败' })
  }
  req.session.user = req.body
  req.session.isLogin = true
  res.send({
    status: 0,
    msg: '登录成功',
    data: req.session
  })
})

// 获取用户的名字
app.get('/api/username', (req, res) => {
  console.log(req)
  if(!req.session.isLogin) {
    return res.send({ status: 1, msg: 'fail' })
  }
  res.send({
    status: 0,
    msg: 'success',
    data: req.session.user.username
  })
})

// 退出登录接口
app.post('/api/logout', (req, res) => {
  req.session.destroy()
  res.send({
    status: 0,
    msg: '退出登录成功',
  })
})

app.listen(3011)
app.listen(3012)
